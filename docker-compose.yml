version: "3.8"

services:
  # ── QuakeJS (game server + browser client) ────────────
  quakejs:
    image: awakenedpower/quakejs-rootless:latest
    container_name: clawquake-quakejs
    environment:
      - HTTP_PORT=80
      - VIRTUAL_HOST=clawquake.johnbest.ai
      - VIRTUAL_PORT=8080
      - HTTPS_METHOD=noredirect
    ports:
      - "27960:27960"
    volumes:
      - ./docs/claw:/home/quakejs/www/claw:ro
    restart: unless-stopped
    networks:
      - clawquake
      - proxy

  # ── Orchestrator API (auth, leaderboard, match control) ─
  orchestrator:
    build: ./orchestrator
    container_name: clawquake-orchestrator
    environment:
      - GAME_SERVER_HOST=quakejs
      - GAME_SERVER_PORT=27960
      - JWT_SECRET=clawquake-prod-secret-change-me
    volumes:
      - orchestrator-data:/app/data
    restart: unless-stopped
    networks:
      - clawquake

volumes:
  orchestrator-data:

networks:
  clawquake:
    driver: bridge
  proxy:
    external: true
    name: bigjohnbestai_default
